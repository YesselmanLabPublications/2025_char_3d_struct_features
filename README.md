# Code to for paper: "Characterizing RNA 3D structural features from DMS reactivity"

bioarxiv link: https://www.biorxiv.org/content/10.1101/2024.11.21.624766v2

By D. H. Sanduni Deenalattha, Chris P. Jurich, Bret Lange, Darren Armstrong, Kaitlyn Nein, Sakshi Jain, and Joseph D. Yesselman
Contact: jyesselm@unl.edu


## Data Download
Make sure to download the data used in this project from DOI 10.6084/m9.figshare.27880434. A direct download link is: `https://figshare.com/ndownloader/files/58663213`. Unzip this data and store it in the `data/` directory within the current project directory. If you encounter a 403 Forbidden error, use the curl command below which sets a user-agent and referer.


## Installation
```bash
git clone https://github.com/YesselmanLabPublications/2025_char_3d_struct_features
cd 2024_dms_3d_features

# Create a new conda environment  also works with mamba / micromamba
conda env create -f environment.yml
# mamba create -n dms-3d-features -f environment.yml
# micromamba create -n dms-3d-features -f environment.yml

# Activate the conda environment
conda activate dms-3d-features

# Install the package
# pip install -e . for development
pip install . 

# Download the data from Figshare (robust)
URL="https://figshare.com/ndownloader/files/58663213"
curl -fL --retry 8 --retry-delay 5 --retry-all-errors \
     -H "User-Agent: Mozilla/5.0" \
     -H "Referer: https://figshare.com/" \
     -o data.zip "$URL"
unzip -q data.zip -d data
rm -f data.zip

# Run the tests
# all should pass
pytest 
```

## Generating the PDB library

```bash
# note this will take a while to generate all 7,500 with --desired-sequences 7500
python dms_3d_features/cli.py generate-pdb-library --motif-csv data/csvs/motif_sequences.csv --desired-sequences 7500
```

## Running the analysis 

### Generate motif data
processes the DMS data generated by rna-map and breaks constructs up into motifs
```bash
python dms_3d_features/cli.py generate-motif-data
```

### Generate 3D features
NOTE you must have 3DNA installed (http://forum.x3dna.org/site-announcements/download-instructions/) to run this script. 

```bash
python dms_3d_features/cli.py generate-pdb-features
```

## Figure generation

All figures are generated in jupyter notebooks in the `notebooks/figures` directory. 